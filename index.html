<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customizable Tabata Timer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body data-theme="light">

    <!-- =========== FIRST TIME SETUP SCREEN =========== -->
    <div id="setupScreen" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Welcome!</h2>
            <p>Let's get you set up. Please enter your name and choose a theme.</p>
            <form id="setupForm" style="margin-bottom: 1rem;">
                <div class="form-group">
                    <label for="setupUsername">Username</label>
                    <input type="text" id="setupUsername" required>
                </div>
                <div class="form-group">
                    <label>Theme</label>
                    <div class="theme-options">
                        <label class="theme-option">
                            <input type="radio" name="theme" value="light" checked>
                            <div class="theme-preview theme-light"></div>
                            <span>Light</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="dark">
                            <div class="theme-preview theme-dark"></div>
                            <span>Dark</span>
                        </label>
                        <label class="theme-option">
                            <input type="radio" name="theme" value="high-contrast">
                            <div class="theme-preview theme-high-contrast"></div>
                            <span>AMOLED</span>
                        </label>
                    </div>
                </div>
                <button type="submit">Get Started</button>
            </form>
            <button id="importSetupBtn" class="secondary" style="width: 100%;">Import Existing Data</button>
        </div>
    </div>

    <!-- =========== HOME SCREEN =========== -->
    <div id="homeScreen" class="app-container" role="main">
        <header class="home-header">
            <h1 id="welcomeMessage">Workouts</h1>
            <div class="header-controls">
                <button id="newWorkoutBtn">New Workout</button>
                <button class="secondary" id="importWorkoutBtn">Import Workout</button>
                <input type="file" id="importWorkoutFileInput" class="hidden" accept=".json">
                <button class="secondary" id="mainSettingsBtn" aria-label="Main Settings">⚙️</button>
            </div>
        </header>

        <section aria-labelledby="controls-heading">
            <h2 id="controls-heading" class="hidden">Workout Controls</h2>
            <div class="search-sort-container">
                <input type="search" id="searchBar" placeholder="Search workouts..." aria-label="Search workouts">
                <select id="sortSelect" aria-label="Sort workouts by">
                    <option value="name-asc">Sort by Name (A-Z)</option>
                    <option value="name-desc">Sort by Name (Z-A)</option>
                    <option value="date-new">Newest First</option>
                    <option value="date-old">Oldest First</option>
                    <option value="color">Sort by Color</option>
                </select>
            </div>
            <div id="workoutList" class="workout-list">
                <!-- Workout cards will be injected here -->
            </div>
            <p id="noWorkoutsMessage" class="hidden">No workouts found. Create one to get started!</p>
        </section>
    </div>

    <!-- =========== WORKOUT EDITOR SCREEN =========== -->
    <div id="editorScreen" class="hidden" role="dialog" aria-modal="true" aria-labelledby="editorTitle">
        <div class="editor-container">
            <header class="editor-header">
                <h2 id="editorTitle">Create Workout</h2>
                <div>
                    <button id="saveWorkoutBtn">Save</button>
                    <button id="cancelEditorBtn" class="secondary">Cancel</button>
                </div>
            </header>
            <form id="workoutForm">
                <input type="hidden" id="workoutId">
                
                <section class="editor-section" aria-labelledby="general-heading">
                    <h3 id="general-heading">General</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label for="workoutTitle">Title</label>
                            <input type="text" id="workoutTitle" required>
                        </div>
                        <div class="form-group">
                            <label for="workoutColor">Color Tag</label>
                            <div id="colorSelector" class="color-selector" role="radiogroup"></div>
                            <input type="hidden" id="workoutColor">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="workoutDescription">Description (Optional)</label>
                        <textarea id="workoutDescription" rows="3"></textarea>
                    </div>
                </section>

                <section class="editor-section" aria-labelledby="timing-heading">
                    <h3 id="timing-heading">Timing</h3>
                     <div class="grid-2">
                        <div class="form-group">
                            <label for="workoutPrepare">Prepare (seconds)</label>
                            <input type="number" id="workoutPrepare" min="0" value="10">
                        </div>
                        <div class="form-group">
                            <label for="prepareMedia">Prepare Media URL (Optional)</label>
                            <input type="text" id="prepareMedia" placeholder="Image or video URL">
                        </div>
                        <div class="form-group">
                            <label for="workoutSets">Sets</label>
                            <input type="number" id="workoutSets" min="1" value="1" required>
                        </div>
                        <div class="form-group">
                            <label for="workoutCooldown">Cooldown (seconds)</label>
                            <input type="number" id="workoutCooldown" min="0" value="30">
                        </div>
                        <div class="form-group">
                            <label for="cooldownMedia">Cooldown Media URL (Optional)</label>
                            <input type="text" id="cooldownMedia" placeholder="Image or video URL">
                        </div>
                    </div>
                </section>
                
                <section class="editor-section" aria-labelledby="steps-heading">
                    <h3 id="steps-heading">Steps</h3>
                    <div id="stepsList">
                        <!-- Step items will be injected here -->
                    </div>
                    <div>
                        <button type="button" class="secondary" id="addWorkStepBtn">Add Work</button>
                        <button type="button" class="secondary" id="addRestStepBtn">Add Rest</button>
                    </div>
                </section>
            </form>
        </div>
    </div>
    
    <!-- =========== TIMER SCREEN =========== -->
    <div id="timerScreen" class="hidden" role="alert" aria-live="assertive">
        <div id="timerContent">
            <div id="timerMediaContainer"></div>
            <div class="timer-details-wrapper">
                <h2 id="timerCurrentCategory">PREPARE</h2>
                <h1 id="timerCurrentName">Workout Title</h1>
                <div class="timer-info-area">
                    <div id="timerCountdown">00:10</div>
                    <div id="timerReps" class="hidden"></div>
                    <p id="timerDescription"></p>
                    <button id="timerDoneBtn" class="primary hidden">Done</button>
                </div>
            </div>
        </div>
        
        <div class="timer-progress-info">
            <p id="timerStepProgress">Set 1 of 3 &bull; Up Next: Push Ups</p>
            <div id="timerOverallProgress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                <div id="timerOverallProgressBar"></div>
            </div>
            <div class="timer-controls">
                <button id="timerPrevBtn" class="secondary">Previous</button>
                <button id="timerPauseResumeBtn">Pause</button>
                <button id="timerSkipBtn" class="secondary">Skip</button>
                <button id="timerFullscreenBtn" class="secondary">Fullscreen ↗️</button>
                <button id="timerQuitBtn" class="danger">Quit</button>
            </div>
        </div>
    </div>

    <!-- =========== MODALS (Settings, Preview) =========== -->
    <div id="mainSettingsModal" class="modal-overlay hidden">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="settings-title">
            <div class="modal-header">
                <h2 id="settings-title">Settings</h2>
                <button class="modal-close-btn" aria-label="Close Settings">&times;</button>
            </div>
            <form id="mainSettingsForm">
                <div class="form-group">
                    <label for="settingsUsername">Username</label>
                    <input type="text" id="settingsUsername" required>
                </div>
                <div class="form-group">
                    <label for="settingsTheme">Theme</label>
                    <select id="settingsTheme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="high-contrast">AMOLED</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="settingsView">Workout Display</label>
                    <select id="settingsView">
                        <option value="grid">Grid View</option>
                        <option value="list">List View</option>
                    </select>
                </div>
                <button type="submit">Save Settings</button>
            </form>
            <div style="margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; display: flex; gap: 1rem;">
                <button id="exportUserDataBtn" class="secondary" style="flex: 1;">Export User Data</button>
                <button id="importUserDataBtn" class="secondary" style="flex: 1;">Import User Data</button>
            </div>
        </div>
    </div>
    
    <div id="previewModal" class="modal-overlay hidden">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="previewTitle">
            <div class="modal-header">
                <h2 id="previewTitle">Workout Preview</h2>
                <button class="modal-close-btn" aria-label="Close Preview">&times;</button>
            </div>
            <div id="previewContent"></div>
        </div>
    </div>
    
    <!-- Hidden file input for all imports -->
    <input type="file" id="importUserDataInput" class="hidden" accept=".json">


    <!-- =========== HTML TEMPLATES =========== -->
    <template id="workoutCardTemplate">
        <div class="workout-card" data-id="">
            <div class="card-main-content">
                <div class="card-header">
                    <h3 class="card-title"></h3>
                    <button class="card-favorite-btn" data-action="favorite" aria-label="Toggle Favorite">☆</button>
                </div>
                <div class="card-content">
                    <p class="card-description"></p>
                </div>
            </div>
            <div class="card-actions">
                <button class="card-start-btn" data-action="start">Start</button>
                <div class="settings-menu-wrapper">
                    <button class="card-settings-btn" data-action="toggle-menu" tabindex="0" aria-label="Workout Settings">⚙️</button>
                    <div class="settings-menu">
                        <button data-action="preview">Preview</button>
                        <button data-action="edit">Edit</button>
                        <button data-action="duplicate">Duplicate</button>
                        <button data-action="exportWorkout">Export Workout</button>
                        <button data-action="delete" class="danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <template id="editorStepTemplate">
        <div class="step-item" data-id="" data-type="">
            <div class="step-header">
                <h4></h4>
                <div class="step-controls">
                    <button data-action="move-up" aria-label="Move step up">▲</button>
                    <button data-action="move-down" aria-label="Move step down">▼</button>
                    <button data-action="delete" class="danger" aria-label="Delete step">&times;</button>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" class="step-name" required>
                </div>
                <div class="form-group">
                    <label>Description (Optional)</label>
                    <input type="text" class="step-description">
                </div>
                <div class="form-group">
                    <label>Duration (seconds, 0 for manual)</label>
                    <input type="number" class="step-duration" min="0" value="30">
                </div>
                <div class="form-group">
                    <label>Reps (Optional)</label>
                    <input type="number" class="step-reps" min="0">
                </div>
            </div>
            <div class="form-group">
                <label>Media URL (Image/Video, Optional)</label>
                <input type="text" class="step-media" placeholder="https://example.com/image.jpg">
            </div>
        </div>
    </template>
    
    <script type="module" src="js/app.js"></script>
</body>
</html>